<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Teacher Account</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Admin Panel - Create Teacher Account</h1>
        <nav>
            <a href="admin_dashboard.html">Dashboard</a>
            <a href="logout.html">Logout</a>
        </nav>
    </header>
    <main>
        <section>
            <h2>New Teacher Account</h2>
            <form id="create-teacher-form" method="POST" action="api/create_teacher.php">
                <label for="teacher-name">Full Name:</label>
                <input type="text" id="teacher-name" name="teacher_name" required>

                <label for="teacher-email">Email:</label>
                <input type="email" id="teacher-email" name="teacher_email" required>

                <label for="teacher-username">Username:</label>
                <input type="text" id="teacher-username" name="teacher_username" required>

                <label for="teacher-password">Password:</label>
                <input type="password" id="teacher-password" name="teacher_password" required>

                <button type="submit">Create Account</button>
            </form>
            <div id="result-message"></div>
        </section>
    </main>
    <script>
        document.getElementById('create-teacher-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const form = e.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            const resultEl = document.getElementById('result-message');

            submitBtn.disabled = true;
            resultEl.textContent = 'Creating account...';

            try {
                const resp = await fetch(form.action, {
                    method: 'POST',
                    body: new FormData(form)
                });

                const raw = await resp.text(); // read raw response for diagnostics
                let payload = null;
                try {
                    payload = JSON.parse(raw); // try parse JSON
                } catch (parseErr) {
                    // not JSON â€” keep raw for message
                }

                if (!resp.ok) {
                    console.error('Server returned error', resp.status, raw);
                    resultEl.textContent = (payload && payload.message) ? payload.message : `Server error: ${resp.status}`;
                } else {
                    if (payload) {
                        resultEl.textContent = payload.message || 'Success';
                        if (payload.success) form.reset();
                    } else {
                        // server returned plain text / HTML (common when PHP has warnings)
                        console.warn('Non-JSON response from server:', raw);
                        resultEl.textContent = raw || 'Account created (no JSON response)';
                    }
                }
            } catch (err) {
                console.error('Fetch failed', err);
                resultEl.textContent = `Request failed: ${err.message}`;
            } finally {
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>

<?php
header('Content-Type: application/json');
// ... handle input, create teacher ...
echo json_encode(['success' => true, 'message' => 'Teacher created']);
?>